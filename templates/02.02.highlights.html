{% extends "00.base.html" %}
{% block title %}Highlights{% endblock %}

{% block content %}
<div class="main-content">
    <h1 class="heading">Highlights</h1>
    <p class="caption">Highlights of Taehyung and Jung Kook!</p>

    <div class="highlights-container">
        {% if highlights %}
            {% for event in highlights %}
            <div class="highlights-card">
                <div class="highlights-header">
                    <h2 class="highlights-title">{{ event.title }}</h2>
                    <p class="highlights-date">{{ event.date.strftime('%B %d, %Y') }}</p>
                </div>

                <div class="highlights-body">
                    <!-- Media Slider -->
                    <div class="media-container">
                        <div class="media-slider">
                            {% set media_files = event.image.split(',') %}
                            {% for media in media_files %}
                            {% set media = media.strip() %}
                            <div class="media-slide{% if loop.first %} active{% endif %}">
                                {% if media.endswith('.mp4') %}
                                <video class="media-video" controls controlsList="nodownload" playsinline webkit-playsinline>
                                    <source src="{{ url_for('static', filename='images/highlights/' ~ event.folder ~ '/' ~ media) }}" type="video/mp4">
                                    Your browser does not support the video tag.
                                </video>
                                {% else %}
                                <img src="{{ url_for('static', filename='images/highlights/' ~ event.folder ~ '/' ~ media) }}"  
                                     alt="{{ event.title }}">
                                {% endif %}
                            </div>
                            {% endfor %}
                        </div>
                        {% if media_files|length > 1 %}
                        <button class="prev">&#10094;</button>
                        <button class="next">&#10095;</button>
                        {% endif %}
                    </div>

                    <div class="highlights-content">
                        <p class="highlights-description">
                            {{ event.description.replace('\n', '<br>') | safe }}
                        </p>
                    </div>
                </div>
            </div>
            {% endfor %}
        {% else %}
        <div class="stay-tuned-banner">
            <p>Taehyung and Jungkook have returned, and the universe is shifting once more.</p>
            <p>While the stage is being set, weâ€™re holding space for whatâ€™s next â€” and itâ€™s going to be unforgettable.ðŸ’œ</p>
            <img src="{{ url_for('static', filename='images/stay_tuned.webp') }}" 
                 alt="Stay Tuned" class="stay-tuned-image">
        </div>
        {% endif %}

    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        document.querySelectorAll('.media-container').forEach(container => {
            const slides = container.querySelectorAll('.media-slide');
            const prevBtn = container.querySelector('.prev');
            const nextBtn = container.querySelector('.next');
            let currentIndex = 0;
    
            function showSlide(index) {
                slides.forEach((slide, i) => {
                    slide.style.display = (i === index) ? "block" : "none";
                });
                // Hide buttons if only one slide
                if(slides.length <= 1) {
                    if(prevBtn) prevBtn.style.display = "none";
                    if(nextBtn) nextBtn.style.display = "none";
                } else {
                    if(prevBtn) prevBtn.style.display = "block";
                    if(nextBtn) nextBtn.style.display = "block";
                }
            }
    
            showSlide(currentIndex);
    
            if(prevBtn) prevBtn.addEventListener("click", () => {
                currentIndex = (currentIndex - 1 + slides.length) % slides.length;
                showSlide(currentIndex);
            });
    
            if(nextBtn) nextBtn.addEventListener("click", () => {
                currentIndex = (currentIndex + 1) % slides.length;
                showSlide(currentIndex);
            });
        });
    });
</script>
        
{% endblock %}
